# 機能詳細：ドメイン識別と初期化 (Auth & Initialization)

## 1. 目的

ユーザーがアクセスしたサイトの URL（ドメイン）から、どの利用企業（テナント）のウィジェットを表示すべきかを動的に特定する。

## 2. 処理フロー

1. **ホスト名取得**: `public/widget.js` が実行時に `window.location.hostname` を取得。
2. **初期化リクエスト**: 取得したドメインをパラメータとして `/api/init` (GET) を呼び出し。
3. **テナント照合**: サーバーサイドで Firestore の `tenants` コレクションを検索。`allowed_domains` 配列に該当ドメインが含まれるドキュメントを特定。
4. **設定返却**: 特定された `tenant_id` およびウィジェットのテーマカラー、企業名などを返却。

## 3. 異常系処理

- **未登録ドメイン**: リクエストを拒否し、コンソールに警告を表示（ウィジェットは描画しない）。
- **複数該当**: 最初に一致したテナントを採用する。

## 4. セキュリティ

- 本番環境では、Vercel のリクエストヘッダー（Referer）を検証し、JS による偽装を防止する。
