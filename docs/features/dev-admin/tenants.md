# ğŸ“‹ ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†ç”»é¢ï¼ˆadmin/tenantsï¼‰æŠ€è¡“ä»•æ§˜æ›¸

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ç®¡ç†ç”»é¢ã«ãŠã‘ã‚‹ä¼æ¥­ï¼ˆãƒ†ãƒŠãƒ³ãƒˆï¼‰ä¸€è¦§ãŠã‚ˆã³ãã®è©³ç´°æƒ…å ±ã®ç®¡ç†æ©Ÿèƒ½ã«é–¢ã™ã‚‹ä»•æ§˜ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚

## ğŸ›ï¸ ç”»é¢æ¦‚è¦
ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ãƒ†ãƒŠãƒ³ãƒˆã‚’ä¸€è¦§è¡¨ç¤ºã—ã€ç‰¹å®šã®ãƒ†ãƒŠãƒ³ãƒˆã‚’é¸æŠã™ã‚‹ã“ã¨ã§ã€ãã®ãƒ†ãƒŠãƒ³ãƒˆã«é–¢é€£ã™ã‚‹ã‚«ãƒ†ã‚´ãƒªã€æƒ³å®šQ&Aã€ãŠã‚ˆã³æœ€æ–°ã®ãƒãƒ£ãƒƒãƒˆãƒ­ã‚°ã‚’ä¸€å…ƒçš„ã«é–²è¦§ã§ãã‚‹2ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ç®¡ç†ç”»é¢ã§ã™ã€‚

### ğŸ¨ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹æˆ
- **å·¦ã‚«ãƒ©ãƒ  (4/12)**: å…¨ãƒ†ãƒŠãƒ³ãƒˆã®ãƒªã‚¹ãƒˆè¡¨ç¤ºã€‚æ–°è¦ç™»éŒ²ãƒœã‚¿ãƒ³ã‚’é…ç½®ã€‚
- **å³ã‚«ãƒ©ãƒ  (8/12)**: é¸æŠã•ã‚ŒãŸãƒ†ãƒŠãƒ³ãƒˆã®è©³ç´°æƒ…å ±ã€‚1ã‚«ãƒ©ãƒ ã®ã‚«ãƒ¼ãƒ‰å½¢å¼ã§ä»¥ä¸‹ã®é †ã«è¡¨ç¤ºã€‚
    1.  ä¼æ¥­åŸºæœ¬æƒ…å ±ï¼ˆãƒ†ãƒŠãƒ³ãƒˆIDã€ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼å«ã‚€ï¼‰
    2.  æœ€æ–°ãƒãƒ£ãƒƒãƒˆãƒ­ã‚°ï¼ˆç›´è¿‘10ä»¶ï¼‰
    3.  ã‚«ãƒ†ã‚´ãƒªä¸€è¦§
    4.  æƒ³å®šQ&Aï¼ˆç´ä»˜ãã‚«ãƒ†ã‚´ãƒªåã‚’è¡¨ç¤ºï¼‰

---

## ğŸ—ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ« (Type Definitions)

Firestoreã®æ­£è¦åŒ–ãŠã‚ˆã³ã‚µãƒ–ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ§‹é€ ã«åŸºã¥ãã€ä»¥ä¸‹ã®å‹ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

```typescript
// ä¼æ¥­ï¼ˆãƒ†ãƒŠãƒ³ãƒˆï¼‰
interface Tenant {
  id: string;               // Firestoreãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆID
  name: string;             // ä¼æ¥­å
  allowed_domains: string[]; // è¨±å¯ãƒ‰ãƒ¡ã‚¤ãƒ³
  theme_color: string;      // ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼è­˜åˆ¥å­
  admin_uid?: string;       // ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼UID
  created_at: any;          // ç™»éŒ²æ—¥æ™‚
}

// ã‚«ãƒ†ã‚´ãƒª (tenants/{id}/categories)
interface Category {
  id: string;
  name: string;
  description: string;
}

// æƒ³å®šQ&A (tenants/{id}/knowledge_base)
interface Knowledge {
  id: string;
  question: string;         // è³ªå•æ–‡
  answer: string;           // å›ç­”æ–‡
  category_ids?: string[];  // é–¢é€£ã‚«ãƒ†ã‚´ãƒªIDã®é…åˆ—
}

// ãƒãƒ£ãƒƒãƒˆãƒ­ã‚° (chat_logs)
interface ChatLog {
  id: string;
  user_query: string;       // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›
  ai_response: string;      // AIã®å›ç­”
  detected_category_ids: string[]; // åˆ¤å®šã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªID
  created_at: any;          // ç™ºç”Ÿæ—¥æ™‚
}
```

---

## ğŸ§  çŠ¶æ…‹ç®¡ç† (State Management)

Nuxt 3ã® `ref` ã‚’ä½¿ç”¨ã—ã€ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ç”»é¢ã®çŠ¶æ…‹ã‚’ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚

| å¤‰æ•°å | å‹ | èª¬æ˜ |
| :--- | :--- | :--- |
| `tenants` | `Tenant[]` | å…¨ä¼æ¥­ãƒªã‚¹ãƒˆã€‚å·¦ã‚«ãƒ©ãƒ ã®è¡¨ç¤ºã«ä½¿ç”¨ã€‚ |
| `selectedTenant` | `Tenant \| null` | ç¾åœ¨è©³ç´°ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹ãƒ†ãƒŠãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‚ |
| `categories` | `Category[]` | é¸æŠä¸­ãƒ†ãƒŠãƒ³ãƒˆã«å±ã™ã‚‹ã‚«ãƒ†ã‚´ãƒªã€‚ |
| `knowledgeBase` | `Knowledge[]` | é¸æŠä¸­ãƒ†ãƒŠãƒ³ãƒˆã®æƒ³å®šQ&Aãƒ‡ãƒ¼ã‚¿ã€‚ |
| `chatLogs` | `ChatLog[]` | é¸æŠä¸­ãƒ†ãƒŠãƒ³ãƒˆã«é–¢é€£ã™ã‚‹æœ€æ–°ãƒ­ã‚°ã€‚ |
| `loadingList` | `boolean` | åˆå›èª­ã¿è¾¼ã¿æ™‚ã®ã‚¹ãƒ”ãƒŠãƒ¼åˆ¶å¾¡ã€‚ |
| `loadingDetails` | `boolean` | ãƒ†ãƒŠãƒ³ãƒˆåˆ‡ã‚Šæ›¿ãˆæ™‚ã®èª­ã¿è¾¼ã¿åˆ¶å¾¡ã€‚ |

---

## ğŸ”„ å‡¦ç†ãƒ•ãƒ­ãƒ¼ (Process Flow)

### 1. åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚ (`onMounted`)
1.  `fetchTenants` é–¢æ•°ã‚’å®Ÿè¡Œã€‚
2.  Firestoreã® `tenants` ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ã€`created_at` ã®é™é †ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã€‚
3.  å–å¾—ã—ãŸ `Timestamp` å‹ã‚’ `toLocaleDateString` ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¦ `tenants` é…åˆ—ã«æ ¼ç´ã€‚

### 2. ãƒ†ãƒŠãƒ³ãƒˆé¸æŠæ™‚ (`selectTenant`)
1.  `loadingDetails` ã‚’ `true` ã«ã—ã€æ—¢å­˜ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã€‚
2.  ä»¥ä¸‹ã®3ã¤ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’ä¸¦åˆ—ï¼ˆã‚ã‚‹ã„ã¯é †æ¬¡ï¼‰å®Ÿè¡Œï¼š
    -   **ã‚«ãƒ†ã‚´ãƒª**: `tenants/{id}/categories` ã‚µãƒ–ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰å…¨ä»¶å–å¾—ã€‚
    -   **æƒ³å®šQ&A**: `tenants/{id}/knowledge_base` ã‚µãƒ–ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰å…¨ä»¶å–å¾—ã€‚
    -   **ãƒãƒ£ãƒƒãƒˆãƒ­ã‚°**: ã‚°ãƒ­ãƒ¼ãƒãƒ«ãª `chat_logs` ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ã€`where("tenant_id", "==", id)` ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦æœ€æ–°10ä»¶ã‚’å–å¾—ã€‚
3.  ã™ã¹ã¦ã®å–å¾—ãŒå®Œäº†å¾Œã€`loadingDetails` ã‚’ `false` ã«æˆ»ã—ã€UIã‚’æ›´æ–°ã€‚

---

## ğŸ› ï¸ æŠ€è¡“çš„ç‰¹è¨˜äº‹é …

### ğŸ” ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ (Firestore Index)
ãƒãƒ£ãƒƒãƒˆãƒ­ã‚°ã®è¡¨ç¤ºã«ãŠã„ã¦ã€`tenant_id` ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨ `created_at` ã«ã‚ˆã‚‹é™é †ã‚½ãƒ¼ãƒˆã‚’çµ„ã¿åˆã‚ã›ã¦ã„ã‚‹ãŸã‚ã€Firestoreå´ã§ **è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹** ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚

### ğŸ”— ã‚«ãƒ†ã‚´ãƒªåç§°ã®è§£æ±º
æƒ³å®šQ&A (`knowledgeBase`) å†…ã«ã¯ã‚«ãƒ†ã‚´ãƒªID (`category_ids`) ã®ã¿ãŒä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã§ã€ã™ã§ã«èª­ã¿è¾¼ã¿æ¸ˆã¿ã® `categories` é…åˆ—ã¨ç…§åˆã—ã€IDã‚’åç§°ã«ç½®æ›ã—ã¦è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚
- **è¤‡æ•°ã‚«ãƒ†ã‚´ãƒªã¸ã®å¯¾å¿œ**: `join(", ")` ã‚’ç”¨ã„ã¦ã€è¤‡æ•°ã®ã‚«ãƒ†ã‚´ãƒªã‚’ã‚³ãƒ³ãƒåŒºåˆ‡ã‚Šã§è¡¨ç¤ºã€‚

### ğŸ¨ ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ã®å‹•çš„é©ç”¨
`getThemeColorClass` ãƒ˜ãƒ«ãƒ‘ãƒ¼ã«ã‚ˆã‚Šã€DBã«ä¿å­˜ã•ã‚ŒãŸã‚«ãƒ©ãƒ¼IDã«åŸºã¥ãã€Tailwind CSSã®ã‚¯ãƒ©ã‚¹ã‚’å‹•çš„ã«è¿”å´ã—ã¦ãƒãƒƒã‚¸ã®è‰²ã‚’åˆ¶å¾¡ã—ã¦ã„ã¾ã™ã€‚

---

## ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€  (Reference)
```text
/tenants (collection)
  /{tenantId} (document)
    /categories (sub-collection)
    /knowledge_base (sub-collection)

/chat_logs (collection)
  /{logId} (document) -> field: tenant_id
```

---
