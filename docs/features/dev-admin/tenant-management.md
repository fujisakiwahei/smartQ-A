# 機能詳細：テナント管理 (Tenant Management) 🏢

---

## 1. 目的

ウィジェットを設置するクライアント企業（テナント）の情報を管理します。設置ドメインによる識別や、ウィジェットのブランドカラーといった、システム全体の挙動を制御するための基盤となる設定を行います。

## 2. データ構造 (Firestore: `tenants`)

保存されるドキュメントの主要なフィールドは以下の通りです。

| フィールド        | 型            | 説明                                                             |
| :---------------- | :------------ | :--------------------------------------------------------------- |
| `name`            | string        | クライアント企業の名称。                                         |
| `allowed_domains` | array<string> | ウィジェットの表示を許可するドメイン（プロトコルなし）のリスト。 |
| `theme_color`     | string        | ウィジェットのテーマカラー名（例: `blue`, `emerald`）。          |
| `created_at`      | timestamp     | ドキュメントの作成日時（Firestore サーバータイムスタンプ）。     |

## 3. 処理フロー

1.  **入力データの正規化**:
    - ユーザーが入力したドメインリストから、空文字列や不要な空白を除去し、有効な文字列のみを配列に格納します。
2.  **Firestore への書き込み**:
    - Firebase Firestore の `addDoc` 関数を用い、`tenants` コレクションにデータを追加します。
3.  **状態遷移**:
    - 登録完了後、企業一覧ページ（`/admin/tenants`）へルーティングを行い、ユーザーに処理の完了を提示します。

## 4. 技術的な実装詳細

### Tailwind CSS の動的クラス対応

テーマカラー選択時、`bg-blue-500` などのクラス名を動的に結合して使用しています。Tailwind CSS の JIT（Just-In-Time）エンジンによるパージ（未使用スタイルの削除）を防止するため、`tailwind.config.ts` の `safelist` にこれらのクラスを明示的に定義しています。

### UI の構造化

入力項目を `STEP 1` から `STEP 3` までの論理的なセクションに分割しています。各セクションは `section` タグで構成され、ユーザーが設定の進捗を把握しやすい設計としています。

## 5. 異常系およびガード条件

- **必須バリデーション**: 企業名（`name`）が未入力の場合、処理を中断します。
- **二重送信防止**: `isSubmitting` フラグを用いて、リクエスト実行中は送信ボタンを無効化（`loading` 状態）します。
- **エラーハンドリング**: 書き込み失敗時には `try...catch` ブロックで例外を捕捉し、ユーザーにエラーを通知します。
